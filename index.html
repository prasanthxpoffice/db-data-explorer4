<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Graph</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/site.css" />
  <link rel="stylesheet" href="css/jquery-ui.css" />
  <link rel="stylesheet" href="css/ui.jqgrid.min.css" />
  <script src="js/jquery-3.6.0.min.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script src="js/jquery.jqgrid.min.js"></script>
  <script src="js/cytoscape.min.js"></script>
  <script src="js/utility.js"></script>
  <script src="js/translation.js"></script>
  <script src="js/graph-core.js"></script>
  <script src="js/graph-data.js"></script>
  <script src="js/graph-view.js"></script>
</head>

<body>
  <div class="graph-app">
    <header
      style="padding: 10px; background: #eee; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc;">
      <h1 data-i18n="app.title" style="margin: 0; font-size: 1.2em;">Graph Data Explorer</h1>
      <div>
        <button id="lang-switch" data-i18n="language.switch">Switch Language</button>
      </div>
    </header>

    <div class="main-content">
      <!-- Sidebar Container -->
      <div id="expandpanel-root"></div>

      <!-- Main Graph Area -->
      <div class="wrap">
        <div id="cy"></div>
        <div id="statusbar-root"></div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      // Check config to potentially hide language switcher
      var appConfig = window.APP_CONFIG || (window.parent && window.parent.APP_CONFIG);
      if (appConfig && appConfig.showLanguageSelector === false) {
        $('#lang-switch').hide();
      }

      // Language Switcher
      $('#lang-switch').on('click', function () {
        window.i18n.toggleLanguage();
        // Re-initialize accordion to handle RTL direction changes if needed
        $("#main-accordion").accordion("refresh");
      });

      // Component Loader Helper
      window.loadComponent = function (url, containerId) {
        // Add timestamp to prevent caching
        var bust = '?t=' + new Date().getTime();
        $.get(url + bust, function (data) {
          $(containerId).html(data);
          // Re-apply translations to loaded content
          window.i18n.applyLanguage(window.i18n.currentLang);
        }).fail(function () {
          console.error("Failed to load component:", url);
          $(containerId).html(window.i18n.get('app.errorLoading'));
        });
      };

      // Load Partials
      window.loadComponent('partials/expandpanel.html', '#expandpanel-root');
      window.loadComponent('partials/search.html', '#search-root');
      window.loadComponent('partials/settings.html', '#settings-root');
      window.loadComponent('partials/statusbar.html', '#statusbar-root');

      // Initialize Graph
      if (window.Graph) {
        window.Graph.init('#cy');
      }
    });
  </script>
</body>

</html>