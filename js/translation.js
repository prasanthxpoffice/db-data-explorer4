const translations = {
    "en-US": {
        "app.title": "Graph Data Explorer",
        "language.switch": "Switch to Arabic",
        "datasource.title": "Data Source",
        "filter.title": "Filter",
        "filter.apply": "Apply",
        "filter.clear": "Clear",
        "filter.dataSource": "Data Source",
        "legends.title": "Legends",
        "legends.nodeName": "Node Name",
        "legends.color": "Color",
        "legends.date": "Date",
        "legends.from": "From",
        "legends.to": "To",
        "settings.title": "Settings",
        "datasource.loading": "Loading...",
        "datasource.errorConfig": "Error loading config",
        "datasource.select": "Select a Data Source",
        "datasource.errorData": "Error loading data",
        "health.title": "System Health",
        "health.checking": "Checking...",
        "health.refresh": "Refresh",
        "health.online": "Online: ",
        "health.offline": "Offline: ",
        "health.serverTime": "Server Time: ",
        "app.errorLoading": "Error loading.",
        "search.title": "Search",
        "search.entity": "Entity",
        "search.placeholder": "Select a Node...",
        "search.inputPlaceholder": "Search...",
        "search.add": "Add",
        "search.noItems": "No items added",
        "search.loading": "Loading...",
        "search.show": "Show",
        "search.error": "Error loading data",
        "settings.nodesBtn": "Entity",
        "nodesettings.title": "Entity Settings",
        "nodesettings.description": "Configure entity appearance and behavior here.",
        "nodesettings.labelColor": "Default Entity Color",
        "nodesettings.labelSize": "Default Entity Size",
        "nodesettings.save": "Save",
        "nodesettings.cancel": "Cancel",
        "nodesettings.col.nodeId": "Node ID",
        "nodesettings.col.columnId": "Column ID",
        "nodesettings.col.groupNode": "Group Node",
        "nodesettings.col.englishName": "English Name",
        "nodesettings.col.arabicName": "Arabic Name",
        "nodesettings.col.color": "Color",
        "nodesettings.col.actions": "Actions",
        "nodesettings.error.save": "Failed to save.",
        "nodesettings.error.load": "Error loading nodes.",
        "nodesettings.error.fetchGroupNodes": "Error fetching group nodes.",
        "settings.relationsBtn": "Relations",
        "relationsettings.title": "Relation Settings",
        "relationsettings.col.sourceColumn": "Source Entity",
        "relationsettings.col.searchColumn": "Search Entity",
        "relationsettings.col.displayColumn": "Display Entity",
        "relationsettings.col.relationColumn": "Relation Entity",
        "relationsettings.col.englishName": "English Name",
        "relationsettings.col.arabicName": "Arabic Name",
        "relationsettings.col.active": "Active",
        "settings.expansionTitle": "Expansion Settings",
        "settings.batchSize": "Batch Size",
        "settings.maxNeighbors": "Max Neighbors"
    },
    "ar-AE": {
        "app.title": "مستكشف بيانات الرسم البياني",
        "language.switch": "Switch to English",
        "datasource.title": "مصدر البيانات",
        "filter.title": "تصفية",
        "filter.apply": "تطبيق",
        "filter.clear": "مسح",
        "filter.dataSource": "مصدر البيانات",
        "legends.title": "الأساطير",
        "legends.nodeName": "اسم العقدة",
        "legends.color": "اللون",
        "legends.date": "التاريخ",
        "legends.from": "من",
        "legends.to": "إلى",
        "settings.title": "الإعدادات",
        "datasource.loading": "جار التحميل...",
        "datasource.errorConfig": "خطأ في تحميل التكوين",
        "datasource.select": "اختر مصدر البيانات",
        "datasource.errorData": "خطأ في تحميل البيانات",
        "health.title": "صحة النظام",
        "health.checking": "جار التحقق...",
        "health.refresh": "تحديث",
        "health.online": "متصل: ",
        "health.offline": "غير متصل: ",
        "health.serverTime": "وقت الخادم: ",
        "app.errorLoading": "خطأ في التحميل.",
        "search.title": "بحث",
        "search.entity": "كيان",
        "search.placeholder": "اختر عقدة...",
        "search.inputPlaceholder": "بحث...",
        "search.add": "إضافة",
        "search.noItems": "لم يتم إضافة عناصر",
        "search.loading": "جار التحميل...",
        "search.show": "عرض",
        "search.error": "خطأ في تحميل البيانات",
        "settings.nodesBtn": "الكيان",
        "nodesettings.title": "إعدادات الكيان",
        "nodesettings.description": "قم بتكوين مظهر وسلوك الكيان هنا.",
        "nodesettings.labelColor": "لون الكيان الافتراضي",
        "nodesettings.labelSize": "حجم الكيان الافتراضي",
        "nodesettings.save": "حفظ",
        "nodesettings.cancel": "إلغاء",
        "nodesettings.col.nodeId": "معرف العقدة",
        "nodesettings.col.columnId": "معرف العمود",
        "nodesettings.col.groupNode": "عقدة المجموعة",
        "nodesettings.col.englishName": "الاسم الإنجليزي",
        "nodesettings.col.arabicName": "الاسم العربي",
        "nodesettings.col.color": "اللون",
        "nodesettings.col.actions": "إجراءات",
        "nodesettings.error.save": "فشل الحفظ.",
        "nodesettings.error.load": "خطأ في تحميل العقد.",
        "nodesettings.error.fetchGroupNodes": "خطأ في جلب عقد المجموعة.",
        "settings.relationsBtn": "العلاقات",
        "relationsettings.title": "إعدادات العلاقات",
        "relationsettings.col.sourceColumn": "كيان المصدر",
        "relationsettings.col.searchColumn": "كيان البحث",
        "relationsettings.col.displayColumn": "كيان العرض",
        "relationsettings.col.relationColumn": "كيان العلاقة",
        "relationsettings.col.englishName": "الاسم الإنجليزي",
        "relationsettings.col.arabicName": "الاسم العربي",
        "relationsettings.col.active": "نشط",
        "settings.expansionTitle": "إعدادات التوسيع",
        "settings.batchSize": "حجم الدفعة",
        "settings.maxNeighbors": "الحد الأقصى للجيران"
    }
};

class TranslationManager {
    constructor() {
        // Try to get lang from parent config, then local storage, then default
        var configLang = (window.parent && window.parent.APP_CONFIG) ? window.parent.APP_CONFIG.Lang : null;
        this.currentLang = configLang || localStorage.getItem('appLang') || 'en-US';

        // Ensure we have a valid supported lang
        if (!translations[this.currentLang]) {
            this.currentLang = 'en-US';
        }

        this.applyLanguage(this.currentLang);
    }

    setLanguage(lang) {
        this.currentLang = lang;
        localStorage.setItem('appLang', lang);

        // Update parent config if possible
        if (window.parent && window.parent.APP_CONFIG) {
            window.parent.APP_CONFIG.Lang = lang;
        }

        this.applyLanguage(lang);
        $(document).trigger('languageChanged', [lang]);
    }

    toggleLanguage() {
        const newLang = this.currentLang === 'en-US' ? 'ar-AE' : 'en-US';
        this.setLanguage(newLang);
    }

    applyLanguage(lang) {
        $('html').attr('lang', lang);
        $('html').attr('dir', lang === 'ar-AE' ? 'rtl' : 'ltr');

        // Update all elements with data-i18n attribute
        $('[data-i18n]').each(function () {
            const key = $(this).data('i18n');
            if (translations[lang] && translations[lang][key]) {
                $(this).text(translations[lang][key]);
            }
        });

        // Update placeholders
        $('[data-i18n-placeholder]').each(function () {
            const key = $(this).data('i18n-placeholder');
            if (translations[lang] && translations[lang][key]) {
                $(this).attr('placeholder', translations[lang][key]);
            }
        });
    }

    get(key) {
        return translations[this.currentLang][key] || key;
    }
}

// Initialize global translation manager
window.i18n = new TranslationManager();
